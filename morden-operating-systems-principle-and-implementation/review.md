这两天在某群的怂恿下，入手了一本陈海波教授主编的《现代操作系统（原理与实现）》，今天大体把实体书的部分和在线的理论部分通读了一遍，简单聊聊对这本书的观感。

本书的第一章〖操作系统概述〗和第三章〖操作系统结构〗是最为精华的两章。

刚写下这句话的时候突然发现全书这两章是陈海波教授写的，果然是 sys 领域深厚积累的前辈。

第一章先是从操作系统的历史以及它所解决的问题出发，定义了操作系统在整个自上而下的软硬件架构中的位置。

本章特别有意思的是〖操作系统的必要性思考〗一节。

由于前文已经介绍了操作系统〖对硬件进行管理和抽象，为应用提供服务并进行管理〗的两大职责，很容易我们就会想，是不是只要有组件提供这个能力就可以让整个软硬件架构 RUN 起来，而不非得要是现存的操作系统呢？

陈老师用两段话来讨论这个问题。

1. 如果没有操作系统，那么应用就需要直接跟硬件打交道，直接实现对硬件资源的管理和抽象的功能。如果应用出现故障，就可能引起计算机直接崩溃，而没有诊断和调试的机会。如果较真地说我在应用层面实现一套硬件资源管理，那其实也就是在做操作系统的工作。实际上，现实世界中一些基于外核架构的 LibOS 和虚拟化容器的方法，正是按照这个思路来实现的。

2. 对于应用希望直接控制硬件的场景，应用的加载与销毁、多个应用之间的切换与隔离等管理工作依然需要操作系统来完成。此外，操作系统也可以从全局的角度更合理地对应用进行调度，从而更加高效地利用硬件资源。

前不久，某 Scala 群里讨论到能不能不要 os 直接跑 jvm，就是这一问题的类似提问。

显然，整个软硬件架构层次里，总要有人做〖对硬件进行管理和抽象，为应用提供服务并进行管理〗的工作。所谓的丢掉 os 理解为不使用传统的 os，那到头来还是需要实现一套跟 os 职责类似的软件。

这一方面的内容，包括为了让 LISP 的指令〖原生〗的作为机器指令运行的[一系列工作](https://en.wikipedia.org/wiki/Lisp_machine)。如果 JVM 要做大概也就是这么个流程。

在这多说两句，计算机技术的关键内容是对现实世界的建模，是把各个学科的规律以一种统一的人类可理解的形式组合起来的技术。现实世界里的 OS、PLT、NETWORK 这些东西的应用，其实都是从很基础的硬件抽象上慢慢堆积起来的，并没有什么常人不可理解的知识壁垒，不必谈之色变或奉为偶像。

第三章〖操作系统结构〗从总体的设计操作系统、设计操作系统功能出发，讲解了现有的宏内核架构、微内核架构、外核架构以及其他操作系统每个架构，还有不同的操作系统框架结构的整体实现，可以说为本书讨论的实例集合圈定了范围。

本书的一大特色就是紧跟时代。由于计算机科学发展的速度实在太快，很多十年前乃至五年前的教材，已经很难较好的反应当下计算机科学领域的关注点和最新进展。

本书的大部分其余章节，质量都属于本科教学教材的上乘，且由于是汉语母语的作者编写的，整体行文更加通畅好理解。可以看出本书的立项和编纂是很郑重其事的，不是随便找几个本科生研究生业余时间打杂翻译交差了事的。

内容上，其余章节的特点在于例子更贴近中国的语境。外文教材往往由于经历的历史发展更加琐碎和具体，在选例上很容易选到一些次要的，局限性很强的实现。而中国在 OS 上的自研能力非常不足，这虽然是个问题，但也导致能传播到中国并落地应用的 OS 整体或局部技术实例已经经过了一轮天然的筛选。

本书涵盖了 AArch64 下的页表设计、iOS 的调度器、多种微内核的 IPC 方案以及同步原语 RCU 的实现等等，当然也包括了大量对 UNIX 系统、Linux 系统以及 POSIX 标准的讨论。对读者站在 2020 年的今天的视角来看待 OS 一路发展做过的尝试和优缺点有不小的启示意义。

当然，本书也并非完美无缺，以至于如果我在豆瓣上给它打分，站在我现在的角度可能会打个 4 分，这当然与个人的阶段有关。

它有上面种种的好处，却仍然逃不出一本优秀的本科/研究生教材的范畴。两章陈海波教授真知灼见的文字可称 distinguished，其他的基础章节虽然例子较新，但读起来也未超过国际上的经典教材例如 CSAPP 或 MOS 给人的印象。进阶部分挺有意思，不过碍于篇幅也是浅尝则止。

实践层面上务实程度不比 Richard Stevens 的 UNIX 经典三件套，科研层面上这点基础的讨论自然也支撑不了研究的洞见。

起初，@haoze   在群里说，教科书都是大同小异的，本科以后要在社区、代码、论文里找答案。我不认同，因为当时我正看到第三章，确实质量很高。

后面就打脸了，确实教科书都是大同小异的。

不过对我来说，能够有这样一个契机，在接触了生产环境的软件运行实况之后，回顾自己本科时不太理解的种种概念，重新梳理一下自己的知识体系，或者就说带着我又读了一部分的 UNIX Programming，这本书还是有它的价值的。

